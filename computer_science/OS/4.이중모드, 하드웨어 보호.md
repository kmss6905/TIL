# 이중모드

## 한 컴퓨터를 여러 사람이 동시에 사용하는 환경

- ex) 대부분의 서버환경
- 또는 한 사람이 여러 개의 프로그램을 동시에 사용
- 한 사람의 고의/실수 프로그램이 전체 영향
    - STOP(CPU 중지), HALT, RESET 등

## 사용자 프로그램은 STOP 등 **치명적 명령 사용 불가하게!**

- 사용자(user) 모드 vs 관리자(supervisor)모드
- 이중 모드( dual mode )
- 관리자 모드 = 시스템 모드 = 모니터 모드 = 특권 모드
- supervisor, system monitor, priviliged mode

## 특권 명령(privileged instructions), 오직 관리자 모드에서 내릴 수 있다.

- STOP, HALT, RESET, SET_TIMER, SET_HW, …

## 이중모드(dual mode)

- 레지스터에 모드를 나타내는 플래그
- 운영체제 서비스 실행될 때는 관리자 모드
- 사용자 프로그램 실행될 때는 사용자 모드
- 하드웨어/소프트웨어 인터럽트 발생하면 관리자 모드
- 운영체제 서비스가 끝나면 다시 사용자모드

## 일반적인 프로그램의 실행

- 프로그램 적재(on memory)
- User mode > (키보드, 마우스) > system mode(ISR) > user mode > (모니터, 디스크, 프린터) > system mode > user mode

# 하드웨어 보호

## 입출력 장치 보호 ( input/output device protection )

- 다른 사용자의 입출력, 정보 등에 방해
- 예) 프린트 혼선, 리셋 등
- 예) 다른 사람의 파일 읽고 쓰기 ( 하드 디스크 )

### 사용자의 잘못된 입출력 명령

- 입출력 명령을 특권 명령으로: IN, OUT
- 입출력을 하려면 운영체제에게 요청하고 (system mode 전환),
- 운영체제가 입출력 대행, 마친 후 다시 user mode 복귀

### 해결법

### 사용자가 입출력 명령을 직접 내린 경우?

## 메모리 보호

### 다른 사용자 메모리 또는 운영체제 영역 메모리 접근

- 우연히 또는 고의로
- 다른 사용자 정보/프로그램에 대한 해킹
- 운영체제 해킹

### 해결법

- MMU를 두어 다른 메모리 영역 침범 감시하도록 (Memory Management Unit)
- MMU 설정은 특권 명령: 운영체제만 바꿀 수 있다.

### 다른 사용자 또는 운영체제 영역 메모리 접근 시도?

- Segement vilolation

## CPU 보호(CPU protection)

### 한 사용자가 실수 또는 고의로 CPU 시간 독점

- 예) while (n = 1) …
- 다른 사용자의 프로그램 실행 불가

### 해결법

- Timer 를 두어 일정 시간 경과 시 타이머 인터럽트
- 인터럽트 > 운영체제 > 다른 프로그램으로 강제 전환