# 3. System Structure & Program Execution 2

### 요약

cpu 는 메모리에 올라와 있는 기계어를 처리(0 과 1로 조합). 매 순간 기계어를 읽어서 실행.

cpu 는 pc 가 가리키고 있는 메모리 주소로 가서 cpu 명령을 실행. 메모리를 가리키고 있던 pc 는 다음 주소를 가리키도록 한다. 즉, cpu에서 그런 instruction 을 실행하게 되면 다음 instruction 주소를 실행할 위치, 프로그램 카운터 4 증가함.

항상 순차적이냐? X → 가령 if 문 등등 . 점프를 하는 인스트럭션을 만나면 점프할 수 있도록 함.

즉. cpu 는 프로그램 카운터라는 cpu안에 있는 레지스터가 가리키고 있는 메모리 주소에서 명령어를 실행하는 것일 뿐.

단, 하나의 명령어 실행 후 다음 명령어를 실행하기 전에 항상 interrupt가 들어온 게 있는 지를 체크한다. 만약 있다면 누가 쓰고 있던 지 상관없이, cpu 제어권이 운영체제 로 넘어가게 된다. 운영체제는 인터럽트 종류에 따라 어떤 동작을 해야하는 지에 대한 함수가 내부 커널 함수로 정의되어 있다.

## 동기식 입출력과 비동기식 입출력

![스크린샷 2023-06-19 오후 4.45.43.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/997d4254-3890-4698-b0d4-df5ba85265df/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.45.43.png)

### 동기식 입출력

- I/O 요청 후 입출력 작업이 완료된 후에야 제어가 사용자 프로그램에 넘어감
- 구현 방법 1
    - I/O가 끝날 때까지 CPU를 낭비시킴
    - 매시점 하나의 IO만 일어날 수 있음
- 구현방법2
    - IO가 완료될 때 까지 해당 프로그램에게서 CPU를 빼앗음
    - IO 처리를 기다리는 줄에 그 프로그램을 줄 세움
    - 다른 프로그램에게 CPU를 줌

### 비동기식 입출력(asynchronous IO)

- IO가 시작된 후 입출력 작업이 끝나기를 기다리지 않고 제어가 사용자 프로그램에 즉시 넘어감

### 두 경우 모두 IO완료는 컨트롤러가 인터럽트로 알려줌

### DMA(Direct Memory Access)

![스크린샷 2023-06-19 오후 7.40.13.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/88a839a9-d814-4b96-9ca5-1adc67a577a5/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.40.13.png)

- 빠른 입출력 장치를 메모리에 가까운 속도로 처리하기 위해 사용
- CPU의 중재 없이 device controller 가 device 의 buffer storage 의 내용을 메모리에 block 단위로 직접 전송
- 바이트 단위가 아니라 block 단위로 인터럽트를 발생시킴

DMA Controller 가 IO 데이터를 메모리에 카피해서 가져옴.

## 서로 다른 입출력 명령어

### I/O를 수행하는 special instruction에 의해

### Memory Mapped I/O에 의해

## 저장장치 계층 구조

![스크린샷 2023-06-19 오후 8.05.24.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7fdfe1fb-27dd-40be-bfd2-208259289f0a/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.05.24.png)

## 프로그램의 실행

![스크린샷 2023-06-19 오후 8.07.25.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9b1fd67a-7dd9-4128-855a-21be26f34e78/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.07.25.png)

![스크린샷 2023-06-19 오후 8.08.54.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ab50619d-8f36-4a0d-8737-5d6d60e6d843/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.08.54.png)

파일 시스템에 파일 형태로 실행 파일이 저장되어 있음. 실행 파일을 실행시키면 메모리에 올라가 프로세스가 됨.

정확히는 물리적인 메모리에 바로 올라가는 것이 아니라. 가상 메모리에 한번 올라가는 단계를 거친다.

어떤 프로그램을 실행시키면 그 프로그램의 Address space(주소 공간)이 생긴다. 자기자신만의 독자적인 주소공간, stack - data - code 로 이루어져 있음.  또한 메모리에서 쫒아 낼때 그냥 지워 버리지 않고, 당장 필요한 것은 물리적인 메모리에 올려놓고, 디스크의 swap area 에 내려 놓는다. 

메모리 주소 변환 계층(하드웨어 장치가 도와줌)

![스크린샷 2023-06-19 오후 8.16.12.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3f4d9f97-5be4-4b1e-9aae-b8f6cd0eb751/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.16.12.png)

PCB : 프로그램을 관리하기 위한 자료구조

Process A, Process B 의 커널 스택 : 어떤 사용자 프로그램이 현재 커널의 코드를 실행 중인가를 스택에 표기해 놓음.

## 사용자 프로그램이 사용하는 함수

![스크린샷 2023-06-19 오후 8.22.13.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c3c39fb4-f0cd-4572-8025-fdaad29530ef/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.22.13.png)

![스크린샷 2023-06-19 오후 8.24.47.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2bc50bfe-acfc-4f8a-a251-11761c2a20e3/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.24.47.png)

### 함수

### 사용자 정의 함수

### 라이브러리 함수

### 커널 함수